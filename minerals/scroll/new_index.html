
<!DOCTYPE html>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<style>

body{
  max-width: 1200px;
  margin: 0px auto;
  font-family: 'roboto',sans-serif;
  color: #000;
  font-style: normal;
}

#container{
  position: relative;
  line-height: 1.6
}

#sections{
  width: 340px;
}

#sections > div{
  background: white;
  height: 70vh;
}
#sections > div:last-child{
  margin-bottom: 30px;
}
#sections > div.graph-scroll-active{
  opacity: 1;
}

#graph{
  width: 600px;
  position: -webkit-sticky;
  position: sticky;
  top: 100px;
  float: right;
}
#graph_text {text-align: center;}

@media (max-width: 925px)  {
  #graph {
    width: 100%;
    margin-left: 0px;
    float: none;
    top: 20px;
  }

  #sections{
    width: auto;
    position: relative;
    margin: 0px auto;
  }

  #sections > div{
    background: rgba(255,255,255,.5);
    padding: 10px;
    border-top: 1px solid;
    border-bottom: 1px solid;
    margin-bottom: 80vh;
    height: 100%;
  }

}

.simple_container {max-width: 600px; margin: 0 auto; line-height: 1.6; font-size: 16px}
.simple_container h1 {font-weight: 400;
    font-size: 2.125em;
    line-height: 2.5rem;
    margin: 17px auto 21px;
    text-align: center;
}
a {
    color: #000;
    text-decoration: none;
    cursor: pointer;
}
.time {font-size: 12px}
</style>
<body>
    <div class="simple_container">
        <h1>50 000 украинцев погибли от COVID-19. Это ужасно много</h1>
    </div>
    <div id='first_picture' style="max-width: 800px; margin: 0 auto;"></div>
    <div class="simple_container">
        <div class="time">26.04.2021</div>
        <p>1 мая в Украине зафиксирован грустный рекорд - 50 000 умерли от коронавируса. Это случилось за 406 дней. Первая смерть была зафиксирована больше года назад. 12 марта 2020 погибла 71-летняя жительница Радомышля. </p>
        <p>С тех пор каждый день умирало в среднем 62 человека (медиана). В последний месяц медианный показатель - 402 смертей в день. Но погибших может быть даже больше: в Академии наук считают показатель избыточной смертности. Он показывает как изменилась смертность в сравнении со средним 2015-2019 годов. Всю осень и декабрь 2020 избыточтоная смертность была от 16% до 33% ежемесячно или суммарно ХХ человек. </p>
        <div id='deaths' style="max-width: 600px; margin: 0 auto;"></div>
        <p>Все эти цифры 400, 1000 или 50 000 человек сложно осознать без сравнения. LIGA.net приводит сравнительную статистику.</p>
    </div>
    <div id='container' class='container-1'>
        <div id='graph'></div>
        <div id='sections'>
            <div>
            </div>
            <div>
                <p>В Украине почти по ровну умерли мужчины и женщины. По 60% в каждом гендере - люди от 60 до 80 лет, еще 20% - старше 80.</p>
            </div>
            <div>
                <p>8% всех погибших жили в Киеве. Но в пересчете на душу населения столица с 4385 смертями далеко не рекорсмен.</p>      
            </div>
            <div>
                <p>Куда хуже обстоят дела в Черновицкой области. В городе Сторожинец с населением 14 000 человек погибло 49 человек. Это самый высокий показатель смертности на 1000 жителей - 3.46. Второе и третье самые "смертельные" места также в Черновицкой области - город Вижница - 3.32 погибших на 1000 жителей, а в Новоселице - 3.17 погибших.</p>      
            </div>
            <div>
                <p>50 000 человек - это половина от населения Сторожинца, Вижницы и Новоселицы. В Украине 460 городов и из-за оккупации мы знаем статистику только в 397 городах. В 82% из них живет меньше 50 000 человек.</p>      
            </div>
        </div>
    </div>

    <div id='container' class='container-2'>
        <div id='graph'></div>
        <div id='sections'>
            <div>
                <p>Украинцы умирают не только от коронавируса. Всего за 2020 год умерло 616 835 человек. За 2020 год от COVID-19 погибли 18 533 человек. 66% умерли от болезней сердца. За 2020 год COVID-19 также унес меньше жизней чем рак и внешние причины смерти, но в 2021 ситуация меняется.</p>      
            </div>
            <div>
                <p>В первые два месяца нового года, за которые Госстат опубликовал статистику смертности, COVID-19 стал третьей самой большой причиной смертности украинцев после болезней кровообращения и рака. </p>
            </div>
            <div>
                <p>Например, на стадионе Олимпиский в Киеве вмещается 70 000.</p>      
            </div>
            <div>
                <p>71% из них погибли.</p>      
            </div>
            <div>
                <p>Либо представьте, что вы в метро. В одном вагоне киевского метрополитена помещается 330 человек, согласно технической характеристики. </p>      
            </div>
            <div>
                <p>Чтобы перевезти 50 000 человек заполнив их полностью, необходимо 152 вагона.</p>      
            </div>
        </div>
    </div>

</body>

<script src="d3v4+jetpack.js"></script>
<script src="graph-scroll.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

<script src="js/first_picture.js"></script>
<script src="js/barchart.js"></script>
<script src="js/pyramidBuilder.js"></script>
<script src="js/makeMiskiMap.js"></script>
<script src="js/train.js"></script>

<script>
    createFirstPicture()
        
    var ukraine = getData('ukraine.json').features;
    
    
    var todayDateFormat = d3.timeFormat("%Y-%m-%d");
    var parseTodayDate = d3.timeParse("%Y-%m-%d");
    var dayMonth = locale.format("%d %B")
    var parseTime = d3.timeParse("%m/%d/%Y");
    //var covid_timeline = getData("https://api-covid19.rnbo.gov.ua/charts/main-data?mode=ukraine");
    var covid_timeline = getData("js/covid_timeline.json");
    
    makeBarChart('deaths',window.innerWidth)
    var oldWidth = 0
    function render(){
        if (oldWidth == innerWidth) return
        oldWidth = innerWidth

        var width = height = d3.select('#graph').node().offsetWidth
        var r = 40


        if (innerWidth <= 925){
            width = innerWidth
            height = innerHeight*.7
        }

        var svg = d3.select('#graph').html('')
            .append('svg')
            .attrs({width: width, height: height})
        
        pyramidBuilder(window.innerWidth)

        var gs = d3.graphScroll()
            .container(d3.select('.container-1'))
            .graph(d3.selectAll('container-1 #graph'))
            .eventId('uniqueId1') 
            .sections(d3.selectAll('.container-1 #sections > div'))
            .on('active', function(index){
                console.log('index:'+String(index))
                var tooltipBee = d3.select("body")
                    .append("div")
                    .style("position", "absolute")
                    .attr('class','tooltip')
                    .style("z-index", "10")
                    .style("visibility", "hidden")
                    .style("padding", "14px")
                    .style("background-color", "white")
                    .style("border", "1px solid #f5f5f5")
                    .style("color", "black")
                    .style("border-radius", "6px")
                    .style("border-color", "black")
                    .style("font", "12px sans-serif")
                    .text("tooltip");
                if (index == 0) {
                    pyramidBuilder(width)
                } else if (index == 1) {
                    var ukraine_map = document.getElementsByClassName('ukraine_map')

                    if (ukraine_map.length == 0) {
                        d3.selectAll(".container-1 .bar.left")
                            .transition().duration(250)
                            .delay(function(d,i){ return i * 50 })
                            //.attr("fill", 'yellow')
                            .attr('width', function(d) {
                                return 0
                            })
                            .attr('y', function(d) {
                                return 0
                            })
                        d3.selectAll(".container-1 .bar.right")
                            .transition().duration(250)
                            .delay(function(d,i){ return i * 50 })
                            .attr('width', function(d) {
                                return 0
                            })
                            .attr('y', function(d) {
                                return 0
                            })
                        d3.selectAll(".container-1 .pyramid")
                            .transition().duration(250)
                            .delay(function(d,i){ return i * 100 })
                            .attr('opacity', '0')
                        d3.selectAll(".container-1 .axis")
                            .transition().duration(250)
                            .delay(function(d,i){ return i * 100 })
                            .attr('transform', 'translate(0) ')
                            .attr('opacity', '0')
                        var width = 600,
                            scale = 1900,
                            height = 450,
                            delta_height = 2
            
                        var projection = d3.geoMercator()
                            .scale(scale)
                            .rotate([-30.32,0])
                            .center([0, 49.96])
                            .translate([width/2.2,height/3]);    

                        var svg = d3.select(".container-1 #graph svg")
                        var g = svg.append("g").attr('class','ukraine_map');

                        g.selectAll("path")
                            .data(ukraine)
                            .enter()
                            .append("path")
                            .transition().duration(250)
                            .delay(function(d,i){ return i * 10 })
                            .attr("fill", "#f5f5f5")
                            .attr("stroke", "#9e9e9e")
                            .attr("stroke-width", "0.5px")
                            .attr("d", d3.geoPath().projection(projection) )
                            .attr("class", "district");
                    
                        var values = export_json.map(d => d.per1000)
                        var radiusMaxValue = 8
                        var radiusSize = d3.scaleLinear()
                            .domain([d3.min(values), d3.max(values)])
                            .range([1,radiusMaxValue]) 

                        var cities_mer = svg.append("g").attr('class','cities_mer');  
                        cities_mer.selectAll(".container-1 circle")
                            .data(export_json)
                            .enter()
                            .append("circle")
                            .attr("fill", 'none')
                            .attr("r", 0)
                            .attr("cx", function(d){ 
                                return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0] 
                                
                            })
                            .attr("cy", function(d){ return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1] })
                            .attr("class", "dot")
                            .on("mouseover", function(d) {
                                tooltipBee.html(
                                    '<h4>'+d.id.split('_')[0]+', '+d.id.split('_')[1]+'</h4>'+
                                    '<p>'+numberWithSpaces(d.pop)+' жителей</p>'+
                                    '<p>'+numberWithSpaces(d.deaths)+' погибших</p>'+
                                    '<p>'+numberWithSpaces(d.per1000)+' погибших на 1000 жителей</p>'
                                    )
                                tooltipBee.style("visibility", "visible")
                            })
                            .on("mousemove", function() {
                                return tooltipBee.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
                            })
                            .on("mouseout", function(d){
                                return tooltipBee.style("visibility", "hidden");
                            });
                        d3.selectAll(".container-1 circle")
                            .transition().duration(1000)
                            .delay(function(d,i){ return i * 5 })
                            .attr("fill", '#78909c')
                            .attr("r",function(d) { return radiusSize(d.per1000) })
                    } else {
                        var width = 600,
                        scale = 1900,
                        delta_height = 3,
                        height = 450;
                        var projection = d3.geoMercator()
                            .scale(1900)
                            .rotate([-30.32,0])
                            .center([0, 49.96])
                            .translate([width/2.2,height/3]);
                        
                        var radiusMaxValue = 8
                        var values = export_json.map(d => d.per1000)

                        var radiusSize = d3.scaleLinear()
                            .domain([d3.min(values), d3.max(values)])
                            .range([1,radiusMaxValue]) 
                            var values = export_json.map(d => d.per1000)
                        var radiusMaxValue = 8
                        var radiusSize = d3.scaleLinear()
                            .domain([d3.min(values), d3.max(values)])
                            .range([1,radiusMaxValue]) 
                        
                        var cities_mer_circles = document.getElementsByClassName('cities_mer')
                        if (cities_mer_circles.length == 0) {
                            var cities_mer = svg.append("g").attr('class','cities_mer');  
                            cities_mer.selectAll(".container-1 circle")
                                .data(export_json)
                                .enter()
                                .append("circle")
                                .attr("fill", 'none')
                                .attr("r", 0)
                                .attr("cx", function(d){ 
                                    return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0] 
                                    
                                })
                                .attr("cy", function(d){ return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1] })
                                .attr("class", "dot")
                                .on("mouseover", function(d) {
                                    tooltipBee.html(
                                        '<h4>'+d.id.split('_')[0]+', '+d.id.split('_')[1]+'</h4>'+
                                        '<p>'+numberWithSpaces(d.deaths)+' погибших</p>'+
                                        '<p>'+numberWithSpaces(d.per1000)+' погибших на 1000 жителей</p>'
                                        )
                                    tooltipBee.style("visibility", "visible")
                                })
                                .on("mousemove", function() {
                                    return tooltipBee.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
                                })
                                .on("mouseout", function(d){
                                    return tooltipBee.style("visibility", "hidden");
                                });
                            d3.selectAll(".container-1 circle")
                                .transition().duration(1000)
                                .delay(function(d,i){ return i * 5 })
                                .attr("fill", '#78909c')
                                .attr("r",function(d) { return radiusSize(d.per1000) })
                        }
   
                        const zoom = d3.zoom()
                            .on('zoom', zoomed);

                        function zoomed() {
                            
                            var svg = d3.select(".container-1 #graph svg")
                            var g = svg.select(".ukraine_map");
                            g.selectAll('path')
                                .attr('transform', d3.event.transform);
                            
                            var cities_mer = svg.select(".cities_mer");
                            cities_mer.selectAll(".container-1 circle")
                                .attr('transform', d3.event.transform);
                            var radiusMaxValue = 8
                            var values = export_json.map(d => d.per1000)

                            var radiusSize = d3.scaleLinear()
                                .domain([d3.min(values), d3.max(values)])
                                .range([1,radiusMaxValue]) 

                            cities_mer.selectAll(".container-1 circle")
                                .transition().duration(200)
                                .delay(function(d,i){ return i * 2 })
                                .attr("fill", '#78909c')
                                .attr("r",function(d) { return radiusSize(d.per1000) })

                        }
                        function transform(x,y,scale) {
                            return d3.zoomIdentity
                                .translate(width/2, height / delta_height)
                                .scale(scale) 
                                .translate(-x,-y);
                            
                        }
                        var kyiv = [31.1,49.96]
                        var coordinates = projection(kyiv);
                        
                        var svg = d3.select(".container-1 #graph svg .ukraine_map")
                        svg.transition()
                            .delay(50)
                            .duration(1000)
                            .call(zoom.transform, transform(coordinates[0],coordinates[1],1))
                    }
                    
                } else if (index == 2) {
                    var width = 600,
                        scale = 1900,
                        delta_height = 2,
                        height = 450;

                    var projection = d3.geoMercator()
                        .scale(1900)
                        .rotate([-30.32,0])
                        .center([0, 49.96])
                        .translate([width/2.2,height/3]);

                    d3.select("#container #tooltip").html('')
                    var ukraine_map = document.getElementsByClassName('ukraine_map')
                        
                    if (ukraine_map.length == 1) {
                        var svg = d3.select(".container-1 #graph svg")
                        
                    } else {
                        d3.select(".container-1 #graph svg").html('')
                        var svg = d3.select(".container-1 #graph svg")
                        var g = svg.append("g").attr('class','ukraine_map');

                        g.selectAll("path")
                            .data(ukraine)
                            .enter()
                            .append("path")
                            .transition().duration(250)
                            .delay(function(d,i){ return i * 10 })
                            .attr("fill", "#f5f5f5")
                            .attr("stroke", "#9e9e9e")
                            .attr("stroke-width", "0.5px")
                            .attr("d", d3.geoPath().projection(projection) )
                            .attr("class", "district");

                        var values = export_json.map(d => d.per1000)

                        var color = d3.scaleThreshold()
                            .domain(makeDomain(0,d3.max(values),.4))
                            .range(["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"]);

                        var radiusMaxValue = 8
                        var radiusSize = d3.scaleLinear()
                            .domain([d3.min(values), d3.max(values)])
                            .range([1,radiusMaxValue]) 

                        var cities_mer = svg.append("g").attr('class','cities_mer');  
                            cities_mer.selectAll(".container-1 circle")
                            .data(export_json)
                            .enter()
                            .append("circle")
                            .attr("fill", 'none')
                            .attr("r", 0)
                            .attr("cx", function(d){ 
                                return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0] 
                                
                            })
                            .attr("cy", function(d){ return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1] })
                            .attr("class", "dot")
                            .on("mouseover", function(d) {
                                tooltipBee.html(
                                    '<h4>'+d.id.split('_')[0]+', '+d.id.split('_')[1]+'</h4>'+
                                    '<p>'+numberWithSpaces(d.pop)+' жителей</p>'+
                                    '<p>'+numberWithSpaces(d.deaths)+' погибших</p>'+
                                    '<p>'+numberWithSpaces(d.per1000)+' погибших на 1000 жителей</p>'
                                    )
                                tooltipBee.style("visibility", "visible")
                            })
                            .on("mousemove", function() {
                                return tooltipBee.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
                            })
                            .on("mouseout", function(d){
                                return tooltipBee.style("visibility", "hidden");
                            });
                        cities_mer.selectAll(".container-1 circle")
                            .transition().duration(100)
                            .delay(function(d,i){ return i * 2 })
                            .attr("r",function(d) { return radiusSize(d.per1000) })
                            .attr("fill", function(d){ 
                                if (d.per1000 > 2) {
                                    return color(d.per1000)
                                } else {
                                    return 'none'
                                }
                            })
                    }
                    
                    const zoom = d3.zoom()
                        .on('zoom', zoomed);

                    function zoomed() {
                        
                        var svg = d3.select(".container-1 #graph svg")
                        var g = svg.select(".ukraine_map");
                        g.attr('id','noclass')
                        g.selectAll('path')
                            .attr('transform', d3.event.transform);
                        
                        var cities_mer = svg.select(".cities_mer");
                        cities_mer.selectAll(".container-1 circle")
                            .attr('transform', d3.event.transform);

                        var values = export_json.map(d => d.per1000)

                        var color = d3.scaleThreshold()
                        .domain(
                            makeDomain(0,d3.max(values),.4)
                            )
                        .range(["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"]);
                        var values = export_json.map(d=>d.per1000)
                        var radiusMaxValue = 8
                        var radiusSize = d3.scaleLinear()
                            .domain([d3.min(values), d3.max(values)])
                            .range([1,radiusMaxValue])
                            
                        cities_mer.selectAll(".container-1 circle")
                            .transition().duration(100)
                            .delay(function(d,i){ return i * 2 })
                            .attr("r",function(d) { return radiusSize(d.per1000) })
                            .attr("fill", function(d){ 
                                if (d.per1000 > 2) {
                                    return color(d.per1000)
                                } else {
                                    return 'none'
                                }
                            })
                    }
                    function transform(x,y,scale) {
                        return d3.zoomIdentity
                            .translate(width/2, height / delta_height)
                            .scale(scale) 
                            .translate(-x,-y);
                        
                    }
                    var kuz = [25.7704167, 48.4413013]
                    var coordinates = projection(kuz);
                    
                    var svg = d3.select(".container-1 #graph svg .ukraine_map")
                    svg.transition()
                        .delay(50)
                        .duration(1000)
                        .call(zoom.transform, transform(coordinates[0],coordinates[1],2.4))
                    
                } else if(index == 3 | index == 4){
                    d3.select("#container .tooltip").html('')
                    var width = 600,
                        scale = 1900,
                        delta_height = 3,
                        height = 450;
                    var projection = d3.geoMercator()
                        .scale(1900)
                        .rotate([-30.32,0])
                        .center([0, 49.96])
                        .translate([width/2.2,height/3]);
                        
                    var ukraine_map = document.getElementsByClassName('ukraine_map')
                    
                    if (ukraine_map.length == 1) {
                        var svg = d3.select(".container-1 #graph svg")
                    } else {
                        d3.select(".container-1 #graph svg").html('')
                        var svg = d3.select(".container-1 #graph svg")
                        var g = svg.append("g").attr('class','ukraine_map');
                        g.selectAll("path")
                            .data(ukraine)
                            .enter()
                            .append("path")
                            .transition().duration(250)
                            .delay(function(d,i){ return i * 10 })
                            .attr("fill", "#f5f5f5")
                            .attr("stroke", "#9e9e9e")
                            .attr("stroke-width", "0.5px")
                            .attr("d", d3.geoPath().projection(projection) )
                            .attr("class", "district"); 
                    }
                    var cities_mer_circles = document.getElementsByClassName('cities_mer')
                    if (cities_mer_circles.length == 0) {
                        var cities_mer = svg.append("g").attr('class','cities_mer');  
                        cities_mer.selectAll(".container-1 circle")
                            .data(export_json)
                            .enter()
                            .append("circle")
                            .attr("fill", 'none')
                            .attr("r", 0)
                            .attr("cx", function(d){ 
                                return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[0] 
                                
                            })
                            .attr("cy", function(d){ return projection([d.geometry.coordinates[0], d.geometry.coordinates[1]])[1] })
                            .attr("class", "dot")
                            .on("mouseover", function(d) {
                                tooltipBee.html(
                                    '<h4>'+d.id.split('_')[0]+', '+d.id.split('_')[1]+'</h4>'+
                                    '<p>'+numberWithSpaces(d.pop)+' жителей</p>'+
                                    '<p>'+numberWithSpaces(d.deaths)+' погибших</p>'+
                                    '<p>'+numberWithSpaces(d.per1000)+' погибших на 1000 жителей</p>'
                                    )
                                tooltipBee.style("visibility", "visible")
                            })
                            .on("mousemove", function() {
                                return tooltipBee.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
                            })
                            .on("mouseout", function(d){
                                return tooltipBee.style("visibility", "hidden");
                            });
                        
                    } else {
                        var cities_mer = svg.select(".cities_mer");
                    }
                    var values = export_json.filter(d => d.pop <= 50000).map(d=>d.pop)
                    var radiusMaxValue = 8
                    var radiusSize = d3.scaleLinear()
                        .domain([d3.min(values), d3.max(values)])
                        .range([1,radiusMaxValue])
                    
                    cities_mer.selectAll(".container-1 circle")
                        .transition().duration(100)
                        .delay(function(d,i){ return i * 2 })
                        .attr("r",function(d) { return radiusSize(d.pop) })
                        .attr("fill", function(d){ 
                            if (d.pop <= 50000) {
                                return '#78909c'
                            } else {
                                return 'none'
                            }
                        })
                      
                    
                    var radiusMaxValue = 8
                    var values = export_json.map(d => d.per1000)

                    var radiusSize = d3.scaleLinear()
                        .domain([d3.min(values), d3.max(values)])
                        .range([1,radiusMaxValue]) 
                        
                    const zoom = d3.zoom()
                        .on('zoom', zoomed);

                    function zoomed() {
                        
                        var svg = d3.select(".container-1 #graph svg")
                        var g = svg.select(".ukraine_map");
                        g.selectAll('path')
                            .attr('transform', d3.event.transform);
                        
                        var cities_mer = svg.select(".cities_mer");
                        cities_mer.selectAll(".container-1 circle")
                            .attr('transform', d3.event.transform);

                    }
                    function transform(x,y,scale) {
                        return d3.zoomIdentity
                            .translate(width/2, height / delta_height)
                            .scale(scale) 
                            .translate(-x,-y);
                        
                    }
                    var kyiv = [31.1,49.96]
                    var coordinates = projection(kyiv);
                    
                    var svg = d3.select(".container-1 #graph svg .ukraine_map")
                    svg.transition()
                        .delay(50)
                        .duration(1000)
                        .call(zoom.transform, transform(coordinates[0],coordinates[1],1))
                }
            })


        var svg2 = d3.select('.container-2 #graph').html('')
            .append('svg')
            .attrs({width: width, height: height})

        var path = svg2.append('path')

        var gs2 = d3.graphScroll()
            .container(d3.select('.container-2'))
            .graph(d3.selectAll('.container-2 #graph'))
            .eventId('uniqueId2')  // namespace for scroll and resize events
            .sections(d3.selectAll('.container-2 #sections > div'))
            .on('active', function(index){
                // 5000 -- 50000
                // -- 12000
                var amount = [2500,234,2500]
                var peopleAmount = [616835,57721,50000]
                var circlePosition = []
                var position = makeDomain(0,amount.slice(index,index+1),1)
                var cyValue = 10
                var cxValue = 0
                position.map(function(d,i) {
                    if (i % 60 == 0 ) {
                        cyValue += 10
                        cxValue = 0
                    } else {
                        cxValue += 1
                    }
                    circlePosition.push({cx:cxValue,cy:cyValue})
                })
                
                d3.select(".container-2 #graph").html('')
            
                var svg = d3.select(".container-2 #graph")
                    .append('svg')
                    .attr("width", width)
                    .attr("height", 500)
                
                svg.selectAll("mycircles")
                    .data(position)
                    .enter()
                    .append("circle")
                        .attr('class','people')
                        .attr('fill','#bdbdbd')
                        .attr("cx", function(d,i){return 10+(circlePosition[i].cx*8)} )
                        .attr("cy", function(d,i) {
                            return circlePosition[i].cy
                        })
                        .attr("r", 0)
            
            var dataPoints = [18533,13000]
            if (index == 0) {
                d3.selectAll(".container-2 .people")
                  .transition().duration(250)
                  .delay(function(d,i){ return i * 2 })
                  .attr("r",3)
                  .transition()
                  .duration(250)
                  .attr("fill", function(d,i) {
                        var limit = dataPoints.slice(index,index+1) * amount.slice(index,index+1) / peopleAmount.slice(index,index+1)
                        if (i < limit) {
                            return '#b71c1c'
                            
                        } else {
                            return '#bdbdbd'
                        }
                    })
                    .delay(function(d,i){ return i * 3 })

            }
            if (index == 1) {
                d3.select(".container-2 #graph").html('')
            
                var svg = d3.select(".container-2 #graph")
                    .append('svg')
                    .attr("width", width)
                    .attr("height", 500)
                
                svg.selectAll("mycircles")
                    .data(position)
                    .enter()
                    .append("circle")
                        .attr('class','people')
                        .attr('fill','#bdbdbd')
                        .attr("cx", function(d,i){return 10+(circlePosition[i].cx*8)} )
                        .attr("cy", function(d,i) {
                            return circlePosition[i].cy
                        })
                        .attr("r", 3)

                d3.selectAll(".container-2 .people")
                    .transition().duration(1000)
                    .attr("r",3)
                    .attr("fill", function(d,i) {
                        var limit = dataPoints.slice(index-1,index) * amount.slice(index-1,index) / peopleAmount.slice(index-1,index)
                        if (i < limit) {
                            return '#b71c1c'
                        } else {
                            return '#bdbdbd'
                        }
                    })
                    .delay(function(d,i){ return i * 3 })

            } else if (index == 2 || index == 3) {
                var position = makeDomain(0,75,.13)
                var innerCircleRadius = 40;
                var outerCircleRadius = 60;

                d3.selectAll(".container-2 #graph")
                    .transition().duration(1000)
                    .attr("opacity",0)

                d3.select('.container-2 #graph').html('')
                
                var svg = d3.select('.container-2 #graph').append('svg').attr('width',width).attr('height',500);
                var group = svg.append("g");
                var originX = width/2;
                
                if (width < 400) {var originY = 160;var x1 = width/2 } else {var originY = 260;var x1 = width/2.2}
                
                var minus = 0
                var colorIndex = 0
                for (minus=1;minus<13;minus++) { 
                    position.forEach(function(d){
                        colorIndex+=1
                        var chairOriginX = originX + ((x1-(minus*10)) * Math.sin(d));
                        var chairOriginY = originY - ((x1-(minus*10)-25) * Math.cos(d));
                        if (index == 3 && colorIndex < 4945) {var color = '#b71c1c'} else {var color = "#bdbdbd"}
                    group.append("circle")
                        .attr('cx',chairOriginX)
                        .attr('cy',chairOriginY)
                        .attr('opacity',0)
                        .attr('class', 'stadium '+'stadium_row'+String(minus))
                        .attr('r', 3)
                        .attr('fill',color)
                    })
                }
                if (index == 2 || index == 3) {
                    for (minus=1;minus<13;minus++) { 
                        d3.selectAll('.stadium_row'+String(minus))
                            .transition()
                            .delay(function(d,i){ return i *2 })
                            .duration(500)
                            .style("opacity", 1);
                    }
                }
            }
            var timesValue = null
            if (index == 4) {
                d3.select('.container-2 #graph').html('');
                d3.select('.container-2 #graph')
                    .attr('opacity',1)
                    .append('div')
                    .attr('id','graph_text')
                    .style('text-align','center;')
                
                d3.select('.container-2 #graph')
                    .append('div')
                    .attr('id','train_svg')
                drawTrain()
            }
            if (index == 5) {
                if (timesValue == null) { var timesValue = -1}
                d3.select('.container-2 #graph').html('');
                d3.select('.container-2 #graph')
                    .attr('opacity',1)
                    .append('div')
                    .attr('id','graph_text')
                    .style('text-align','center;')
                if (timesValue != -1) {
                    d3.select('.container-2 #graph #graph_text')
                    .append('span')
                    .attr('id','train_number')
                    .html('<span id="train_number">'+String(timesValue)+'</span> человек проехали в вагонах</div>')
                }
                
                d3.select('.container-2 #graph')
                    .append('div')
                    .attr('id','train_svg')

                animateTrain(timesValue)
            }
        })
    d3.select('#source')
        .styles({'margin-bottom': window.innerHeight - 450 + 'px', padding: '100px'})
    }

    render()
    d3.select(window).on('resize', render)


</script>
