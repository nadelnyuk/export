
<!DOCTYPE html>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<style>

body{
  max-width: 1200px;
  margin: 0px auto;
  font-family: 'roboto',sans-serif;
  color: #000;
  font-style: normal;
}

#container{
  position: relative;
  line-height: 1.6
}

#sections{
  width: 340px;
  margin: 0 auto;
}

#sections > div{
  background: white;
  z-index: 99;
  position: relative;
  background: transparent;
  transition: all .5s linear;
  padding: 70vh 0 7vh 0;
}
#sections p {
    background: #fff;
    border-radius: 4px;
    padding: 15px;
    box-shadow: 0px 0px 10px 3px rgba(0,0,0,0.04);
}
#sections > div:last-child{
  margin-bottom: 30px;
}
#sections > div.graph-scroll-active{
  opacity: 1;
}

#graph{
  width: 1200px;
  position: -webkit-sticky;
  position: sticky;
  top: 10px;
  z-index: 1;
}
#graph_text {text-align: center;}

@media (max-width: 925px)  {
  #graph {
    width: 100%;
    margin-left: 0px;
    float: none;
    top: 120px;
  }

  #sections{
    width: auto;
    position: relative;
    margin: 0px auto;
  }

  #sections > div{
    background: rgba(255,255,255,.8);
    padding: 10px;
    box-shadow: -1px -1px 5px -1px rgb(0 0 0 / 19%), 3px 4px 5px 0px rgb(0 0 0 / 19%);
    margin-bottom: 80vh;
    height: 100%;
  }
}

.simple_container {max-width: 600px; margin: 0 auto; line-height: 1.6; font-size: 16px}
.simple_container h1 {font-weight: 400;
    font-size: 2.125em;
    line-height: 2.5rem;
    margin: 17px auto 21px;
    text-align: center;
}
a {
    color: #000;
    text-decoration: none;
    cursor: pointer;
    border-bottom: 1px solid black;
}
.time {font-size: 12px}
.annotation-note-title {text-shadow:1px 1px 2px white, 0 0 1em white, 0 0 0.2em white;}
.news_links {padding: 0px 15px; font-style: italic; font-size: .8em}
</style>
<body>
    <div id="scatter_area"></div>
    <div class="simple_container">
        <h1>Украинские недра</h1>
    </div>
    <!-- <div id='first_picture' style="max-width: 800px; margin: 0 auto;"></div> -->
    <!-- <div id='first_picture' style="max-width: 1280px;"></div> -->
    <div class="simple_container">
        <p>Владимир Зеленский всерьез озаботился украинскими недрами. Последние полгода мы можем встречать такие новости и заявления: </p>
        <p class="news_links">В марте 2021 года СНБО <a href="https://biz.liga.net/ekonomika/all/novosti/snbo-vvodit-sanktsii-protiv-kompaniy-iz-sfery-polzovaniya-nedrami">ввел санкции</a> против 19 компаний, работающих в сфере пользования недрами. </p>
        <p class="news_links">Каждый несовершеннолетний гражданин Украины будет получать процент от добычи полезных ископаемых из украинских недр, <a href="https://biz.liga.net/ekonomika/tek/novosti/kajdyy-rebenok-budet-poluchat-protsent-ot-ispolzovaniya-nedr-na-obrazovanie-zelenskiy">сказал</a> Зеленский в июне на форуме "Украина 30. Экология", а затем повторил на пресс-конференции в ноябре. </p>
        <p class="news_links">В июле президент <a href="https://biz.liga.net/ekonomika/all/novosti/zelenskiy-vvel-v-deystvie-reshenie-snbo-o-strategicheskih-poleznyh-iskopaemyh">подписал указ</a>, вводящий в действие решение СНБО от 16 июля о стимулировании разведки, добычи и обогащения полезных ископаемых, которые имеют стратегическое значение для экономики и обороноспособности Украины. Чуть позднее секретарь СНБО Алексей Данилов <a href="https://biz.liga.net/all/all/novosti/poleznye-iskopaemye-budut-pod-osobym-kontrolem-gosudarstva-snbo">добавил</a>: "137 видов сырья и полезных ископаемых, будут находиться под особым контролем государства."</p>
        <p>В конце декабря 2021 СНБО опубликовало <a href="https://biz.liga.net/ekonomika/all/novosti/sekretar-snbo-predstavil-sistemu-monitoringa-polzovaniya-nedrami">данные</a> о пользовании украинскими недрами. LIGA.net рассказывает, кто владеет и сколько добывает и платит за использование украинских недр.</p>
    </div>
    <div id='container' class='container-1'>
        <div id='graph'></div>
        <div id='sections'>
            <div><p>Это карта 3 070 украинских недр. С первого взгляда кажется, что на карте Украины почти нет "живого" места без "богатства". Хотя чаще всего под недрами подразумевают месторождения газа и нефти, но на этой карте есть все -- даже минеральные грязи.</p></div>
            <div><p>Чаще всего в перечне украинских недр вы встретите воду. Таких месторождений в Украине почти 800 (26%) и они бывают разная: вода техническая, питьевая, минеральная.</p></div>
            <div><p>Кроме газа и нефти, в Украине также можно добывать много сырья для строительства -- песок, суглинок, гранит, известняк, габбро. </p></div>
            <div><p>В Украине даже добывают немного золота, драгоценных металов и уран</p></div>
            <div><p>Наличие месторождения на карте -- не означает его использование. 23% месторождений не имет лицензию на добычу и на их территории проводится геологическая разведка либо строительство.</p></div>
            <div><p style="background: none;box-shadow: none;"></p></div>
            <div><p style="background: none;box-shadow: none;"></p></div>
        </div>
    </div>
    <div class="simple_container">
        <h3>Кто владеет украинскими недрами?</h3>
        <p>Государство</p>
        <p>Игорь Коломойский</p>
        <p>Дочки Николая Злочевского</p>
    </div>


</body>

<script src="d3v4+jetpack.js"></script>
<script src="graph-scroll.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js" integrity="sha512-iBAeBWWWFb8HqSBcrqcz98iIpuVH1la39dEYHtyQ/pGpeCQTQVvLJOWAuhv2Q7JSHp9k7hWA7sGxU3hHJe+tFg==" crossorigin="anonymous"></script>

<!-- <script src="js/first_picture.js"></script> -->
<script src="minerals_map.js"></script>
<script src="js/render.js"></script>
<!-- <script src="js/train.js"></script> -->
<script src="minerals_map.js"></script>
<script>
    
    //createFirstPicture()
    var ukraine = getData('ukraine.json').features;
    
    var todayDateFormat = d3.timeFormat("%Y-%m-%d");
    var parseTodayDate = d3.timeParse("%Y-%m-%d");
    var dayMonth = locale.format("%d %B")
    var parseTime = d3.timeParse("%m/%d/%Y");
    //var covid_timeline = getData("https://api-covid19.rnbo.gov.ua/charts/main-data?mode=ukraine");
    var covid_timeline = getData("js/covid_timeline.json");
    
    var oldWidth = 0
    function render(){
        if (oldWidth == innerWidth) return
        oldWidth = innerWidth

        var width = height = d3.select('#graph').node().offsetWidth
        var r = 40

        width = getWidth(d3.select('#graph').node().offsetWidth),
        height = getHeight(d3.select('#graph').node().offsetWidth)
        //makeColumnChart('deaths',width)
        var svg = d3.select('#graph').html('')
            .append('svg')
            .attrs({width: width, height: height})

        var gs = d3.graphScroll()
            .offset(1000)
            .container(d3.select('.container-1'))
            .graph(d3.selectAll('container-1 #graph'))
            .eventId('uniqueId1') 
            .sections(d3.selectAll('.container-1 #sections > div'))
            .on('active', function(index){
                width = getWidth(d3.select('#graph').node().offsetWidth),
                height = getHeight(d3.select('#graph').node().offsetWidth)
                //console.log('index:'+String(index))
                var tooltipBee = d3.select("body")
                    .append("div")
                    .style("position", "absolute")
                    .attr('class','tooltip')
                    .style("z-index", "10")
                    .style("visibility", "hidden")
                    .style("padding", "14px")
                    .style("background-color", "white")
                    .style("border", "1px solid #f5f5f5")
                    .style("color", "black")
                    .style("border-radius", "6px")
                    .style("border-color", "black")
                    .style("font", "12px sans-serif")
                    .text("tooltip");
                if (index <= 2) {
                    var ukraine_map = document.getElementsByClassName('ukraine_map')

                    if (ukraine_map.length == 0) {

                        var projection = getProjection(width,height)

                        var svg = d3.select(".container-1 #graph svg")
                        
                        /* svg.append("text")
                            .attr("x", (width / 2) ) 
                            .attr("y", 10)
                            .attr("text-anchor", "middle")
                            .attr("class", "title")
                            .attr("id", "head_title")
                            .style("font-size", '12px')
                            .style("font-family", 'sans-serif')
                            .text('Заголовок');
                        svg.append("text")
                            .attr("x", width-50) 
                            .attr("y", height-35)
                            .attr("text-anchor", "middle")  
                            .attr("class", "subtitle title")
                            .style("font-size", '10px')
                            .style("font-family", 'sans-serif')
                            .style("fill", "#9e9e9e")
                            .text('Данные: СНБО'); */
                        var g = svg.append("g").attr('class','ukraine_map');
                        drawMap(g,projection)
                        drawCircles(projection,1,tooltipBee)
                        d3.selectAll('path.field')
                            .transition().duration(250)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                    } else {
                        var projection = getProjection(width,height)

                        var cities_mer_circles = document.getElementsByClassName('cities_mer')
                        if (cities_mer_circles.length == 0) {
                            drawCircles(projection,1,tooltipBee)
                        }
                        d3.selectAll('path.field')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                        
                    }
                } else if (index == 3) {
                    
                    var svg = d3.select(".container-1 #graph svg")
                    //d3.selectAll(".bar_title").attr('opacity',0)
                    //d3.selectAll(".subtitle").attr('opacity',0)
                    var projection = getProjection(width,height)
                    //d3.selectAll(".title").transition().duration(500).style('opacity',0)
                    d3.select("#container #tooltip").html('')
                    var ukraine_map = document.getElementsByClassName('ukraine_map')
                        
                    if (ukraine_map.length == 1) {
                        //var svg = d3.select(".container-1 #graph svg")
                        d3.selectAll('path.field')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id15')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                        d3.selectAll('path.id17')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                        
                    } else {
                        d3.select(".container-1 #graph svg").html('')
                        var svg = d3.select(".container-1 #graph svg")
                        var g = svg.append("g").attr('class','ukraine_map');

                        drawMap(g,projection)
                        
                        drawCircles(projection,1,tooltipBee)
                        d3.selectAll('path.field')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id9')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                        d3.selectAll('path.id18')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                    }
                    
                } else if (index == 4){
                    var svg = d3.select(".container-1 #graph svg")
                    var projection = getProjection(width,height)
                        
                    var ukraine_map = document.getElementsByClassName('ukraine_map')
                    if (ukraine_map.length == 1) {
                        var svg = d3.select(".container-1 #graph svg")
                        d3.selectAll('path.id9')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id18')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id15')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id17')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id13')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')

                    } else {
                        var svg = d3.select(".container-1 #graph svg")
                        var g = svg.append("g").attr('class','ukraine_map');
                        drawMap(g,projection)
                        d3.selectAll('path.id13')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                    }
                    
                    var cities_mer_circles = document.getElementsByClassName('cities_mer')
                    if (cities_mer_circles.length == 0) {
                        drawCircles(projection,1,tooltipBee)
                    }
                    const zoom = d3.zoom()
                        .on('zoom', zoomed);

                    function zoomed() {
                        
                        var svg = d3.select(".container-1 #graph svg")
                        //d3.select(".container-1 #graph").style('top','100px')
                        var g = svg.select(".ukraine_map");
                        g.selectAll('path')
                            .attr('transform', d3.event.transform);
                        
                        var cities_mer = svg.select("path");
                        svg.selectAll(".field")
                            .attr('transform', d3.event.transform);

                    }
                    mapZooming(1,zoom)  
                    
                    
                } else if (index == 5){
                    var svg = d3.select(".container-1 #graph svg")
                    var projection = getProjection(width,height)
                        
                    var ukraine_map = document.getElementsByClassName('ukraine_map')
                    if (ukraine_map.length == 1) {
                        var svg = d3.select(".container-1 #graph svg")
                        d3.selectAll('path.id13')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id15')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                        d3.selectAll('path.id17')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                    } else {
                        var svg = d3.select(".container-1 #graph svg")
                        var g = svg.append("g").attr('class','ukraine_map');
                        drawMap(g,projection)
                        d3.selectAll('path.id15')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                        d3.selectAll('path.id17')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                    }
                    
                    var cities_mer_circles = document.getElementsByClassName('cities_mer')
                    if (cities_mer_circles.length == 0) {
                        drawCircles(projection,1,tooltipBee)
                    }
                     
                    
                } else if (index == 6){
                    var svg = d3.select(".container-1 #graph svg")
                    var projection = getProjection(width,height)
                        
                    var ukraine_map = document.getElementsByClassName('ukraine_map')
                    if (ukraine_map.length == 1) {
                        var svg = d3.select(".container-1 #graph svg")
                        d3.selectAll('path.id15')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id17')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.d0')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                    } else {
                        var svg = d3.select(".container-1 #graph svg")
                        var g = svg.append("g").attr('class','ukraine_map');
                        drawMap(g,projection)
                        d3.selectAll('path.id15')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id17')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.d0')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                    }
                    
                    var cities_mer_circles = document.getElementsByClassName('cities_mer')
                    if (cities_mer_circles.length == 0) {
                        drawCircles(projection,1,tooltipBee)
                        d3.selectAll('path.id15')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.id17')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','0')
                        d3.selectAll('path.d0')
                            .transition().duration(150)
                            .delay(function(d,i){ return i * 2 })
                            .style('opacity','1')
                    }
                     
                    
                } 
            })

    d3.select('#source')
        .styles({'margin-bottom': window.innerHeight - 450 + 'px', padding: '100px'})
    }

    render()
    d3.select(window).on('resize', render)


</script>
<script src="details.js"></script>